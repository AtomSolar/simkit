
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Tutorial 4: Data &#8212; SimKit SimKit documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial 5: Models and Simulations" href="tutorial_5.html" />
    <link rel="prev" title="Tutorial 3: More Detail on Units and Uncertainty" href="tutorial_3_detail.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="tutorial-4-data">
<span id="tutorial-4"></span><h1>Tutorial 4: Data<a class="headerlink" href="#tutorial-4-data" title="Permalink to this headline">¶</a></h1>
<p>The PV system power demo now has outputs, calculations and formulas defined. Now
it just needs some data. Data are values that are read from sources such as an
Excel workbook or a CSV file. Data are different from outputs because data are
known before a simulation, whereas outputs are calculated during the simulation.
To specify data, subclass <code class="xref py py-class docutils literal notranslate"><span class="pre">DataSource</span></code> and
declare each data by name as class attributes equal to an instance of
<code class="xref py py-class docutils literal notranslate"><span class="pre">DataParameter</span></code> containing the
<a class="reference internal" href="#data-attrs"><span class="std std-ref">Data Attributes</span></a> as arguments. Here’s an example for our PV system power
model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">simkit.core.data_sources</span> <span class="kn">import</span> <span class="n">DataSource</span><span class="p">,</span> <span class="n">DataParameter</span>
<span class="kn">from</span> <span class="nn">simkit.core</span> <span class="kn">import</span> <span class="n">UREG</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">pvlib</span>


<span class="k">class</span> <span class="nc">PVPowerData</span><span class="p">(</span><span class="n">DataSource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Data sources for PV Power demo.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">latitude</span> <span class="o">=</span> <span class="n">DataParameter</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;degrees&quot;</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">longitude</span> <span class="o">=</span> <span class="n">DataParameter</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;degrees&quot;</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">elevation</span> <span class="o">=</span> <span class="n">DataParameter</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;meters&quot;</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">timestamp_start</span> <span class="o">=</span> <span class="n">DataParameter</span><span class="p">()</span>
    <span class="n">timestamp_count</span> <span class="o">=</span> <span class="n">DataParameter</span><span class="p">()</span>
    <span class="n">module</span> <span class="o">=</span> <span class="n">DataParameter</span><span class="p">()</span>  <span class="c1"># a dictionary</span>
    <span class="n">inverter</span> <span class="o">=</span> <span class="n">DataParameter</span><span class="p">()</span>  <span class="c1"># a dictionary</span>
    <span class="n">module_database</span> <span class="o">=</span> <span class="n">DataParameter</span><span class="p">()</span>  <span class="c1"># a list</span>
    <span class="n">inverter_database</span> <span class="o">=</span> <span class="n">DataParameter</span><span class="p">()</span>  <span class="c1"># a list</span>
    <span class="n">Tamb</span> <span class="o">=</span> <span class="n">DataParameter</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;degC&quot;</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">Uwind</span> <span class="o">=</span> <span class="n">DataParameter</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;m/s&quot;</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">surface_azimuth</span> <span class="o">=</span> <span class="n">DataParameter</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s2">&quot;degrees&quot;</span><span class="p">,</span> <span class="n">uncertainty</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">timezone</span> <span class="o">=</span> <span class="n">DataParameter</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__prepare_data__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># set frequencies</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;HOURLY&#39;</span><span class="p">,</span> <span class="s1">&#39;MONTHLY&#39;</span><span class="p">,</span> <span class="s1">&#39;YEARLY&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isconstant</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># apply metadata</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="c1"># TODO: this should be applied in data reader using _meta_names from</span>
            <span class="c1"># data registry which should use a meta class and all parameter</span>
            <span class="c1"># files should have same layout even xlrd and numpy readers, etc.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isconstant</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># set all data &quot;isconstant&quot; True</span>
            <span class="c1"># uncertainty is dictionary</span>
            <span class="k">if</span> <span class="s1">&#39;uncertainty&#39;</span> <span class="ow">in</span> <span class="n">v</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">uncertainty</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;uncertainty&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">UREG</span><span class="o">.</span><span class="n">percent</span><span class="p">}</span>
        <span class="c1"># convert initial timestamp to datetime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp_start&#39;</span><span class="p">])</span>
        <span class="c1"># get module and inverter databases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;module_database&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">pvsystem</span><span class="o">.</span><span class="n">retrieve_sam</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;module_database&#39;</span><span class="p">],</span> <span class="n">path</span><span class="o">=</span><span class="n">SANDIA_MODULES</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;inverter_database&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">pvsystem</span><span class="o">.</span><span class="n">retrieve_sam</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;inverter_database&#39;</span><span class="p">],</span> <span class="n">path</span><span class="o">=</span><span class="n">CEC_INVERTERS</span>
        <span class="p">)</span>
        <span class="c1"># get module and inverter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;module_database&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;inverter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;inverter_database&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;inverter&#39;</span><span class="p">]]</span>
        <span class="p">)</span>
</pre></div>
</div>
<div class="section" id="data-attributes">
<span id="data-attrs"></span><h2>Data Attributes<a class="headerlink" href="#data-attributes" title="Permalink to this headline">¶</a></h2>
<p>The following data attributes can be passed as arguments to each data parameter.
If using positional arguments, then their order is given in the table below, but
keyword arguments can be passed to <code class="docutils literal notranslate"><span class="pre">DataParameter</span></code> in any order.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Attribute</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>units</p></td>
<td><p>units from <a class="reference external" href="http://pint.readthedocs.io/">Pint</a></p></td>
</tr>
<tr class="row-odd"><td><p>uncertainty</p></td>
<td><p>measure of uncertainty, typically 2-sigma</p></td>
</tr>
<tr class="row-even"><td><p>isconstant</p></td>
<td><p>doesn’t vary in dynamic simulations</p></td>
</tr>
<tr class="row-odd"><td><p>timeseries</p></td>
<td><p>index of dynamic simulation inputs</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="meta-class-options">
<h2>Meta Class Options<a class="headerlink" href="#meta-class-options" title="Permalink to this headline">¶</a></h2>
<p>Options that apply to the entire data class like the data reader or enabling
data caching are specified in a nested <code class="docutils literal notranslate"><span class="pre">Meta</span></code> class.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 25%" />
<col style="width: 75%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Meta Class Option</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>data_reader</p></td>
<td><p>name of <code class="xref py py-class docutils literal notranslate"><span class="pre">DataReader</span></code></p></td>
</tr>
<tr class="row-odd"><td><p>data_cache_enabled</p></td>
<td><p>toggle caching of data from file readers as JSON</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="uncertainty-and-variance">
<h2>Uncertainty and Variance<a class="headerlink" href="#uncertainty-and-variance" title="Permalink to this headline">¶</a></h2>
<p>Uncertainty should be given in units of percent from <a class="reference internal" href="../api/core.html#simkit.core.UREG" title="simkit.core.UREG"><code class="xref py py-data docutils literal notranslate"><span class="pre">UREG</span></code></a>
or it will raise <a class="reference internal" href="../api/exceptions.html#simkit.core.exceptions.UncertaintyPercentUnitsError" title="simkit.core.exceptions.UncertaintyPercentUnitsError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">UncertaintyPercentUnitsError</span></code></a>
when registered in the data registry. Variance is calculated from the square of
the uncertainty when the data is instantiated. The data registry also checks
when it registers new data that variance is the square of the uncertainty or it
raises <a class="reference internal" href="../api/exceptions.html#simkit.core.exceptions.UncertaintyVarianceError" title="simkit.core.exceptions.UncertaintyVarianceError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">UncertaintyVarianceError</span></code></a>.</p>
</div>
<div class="section" id="preparing-data">
<h2>Preparing Data<a class="headerlink" href="#preparing-data" title="Permalink to this headline">¶</a></h2>
<p>The data superclass doesn’t automatically apply some of the attributes, such as
<code class="docutils literal notranslate"><span class="pre">isconstant</span></code> and <code class="docutils literal notranslate"><span class="pre">uncertainty</span></code>; these attributes must be applied in the
data source class <code class="docutils literal notranslate"><span class="pre">__prepare_data__</span></code> method, an abstract method that <em>must</em> be
concrete in the subclass or it will raise <code class="xref py py-exc docutils literal notranslate"><span class="pre">exceptions.NotImplementedError</span></code>.
If there is nothing to prepare, then use <code class="docutils literal notranslate"><span class="pre">pass</span></code>.</p>
<p>The prepare data method is good place to handle several tasks.</p>
<ul class="simple">
<li><p>pop values from one data source to another</p></li>
<li><p>apply uncertainty</p></li>
<li><p>non-dimensionalize parameters</p></li>
<li><p>set constants</p></li>
<li><p>convert types such as string to datetime</p></li>
</ul>
</div>
<div class="section" id="data-readers">
<h2>Data Readers<a class="headerlink" href="#data-readers" title="Permalink to this headline">¶</a></h2>
<p>Every data source has one of the <code class="xref py py-class docutils literal notranslate"><span class="pre">DataReader</span></code>
classes. The default is the <code class="xref py py-class docutils literal notranslate"><span class="pre">JSONReader</span></code>. The
data readers collect data depending on the attributes of the parameters
specified in the data source. There are also some newer readers in the
contributions folder, such as <code class="xref py py-class docutils literal notranslate"><span class="pre">ArgumentReader</span></code>
and <code class="xref py py-class docutils literal notranslate"><span class="pre">DjangoModelReader</span></code>.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/sp_2014_logo_black_orange_rgb.png" alt="Logo"/>
    
    <h1 class="logo logo-name">SimKit</h1>
    
  </a>
</p>



<p class="blurb">Model Simulation Framework</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=BreakingBytes&repo=SimKit&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/BreakingBytes/SimKit">
    <img
        alt="https://secure.travis-ci.org/BreakingBytes/SimKit.svg?branch=master"
        src="https://secure.travis-ci.org/BreakingBytes/SimKit.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_1.html">Tutorial 1: Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_2.html">Tutorial 2: Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_3.html">Tutorial 3: Formulas</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_3_detail.html">Tutorial 3: More Detail on Units and Uncertainty</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial 4: Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#data-attributes">Data Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#meta-class-options">Meta Class Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#uncertainty-and-variance">Uncertainty and Variance</a></li>
<li class="toctree-l2"><a class="reference internal" href="#preparing-data">Preparing Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-readers">Data Readers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial_5.html">Tutorial 5: Models and Simulations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/developer.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/core.html">Core</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/layers.html">Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/outputs.html">Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/calculations.html">Calculations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/calculations.html#module-simkit.core.calculators">Calculators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/simulations.html">Simulations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/data-sources.html">Data Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/data-sources.html#data-readers">Data Readers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/formulas.html">Formulas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/contrib.html">Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/exceptions.html">Exceptions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../announcements/caramel-corn.html">Caramel Corn CONSTANTS (v0.3.1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../announcements/brown-bicycle-bears.html">Brown Bicycle Bears (v0.2.7)</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="tutorial_3_detail.html" title="previous chapter">Tutorial 3: More Detail on Units and Uncertainty</a></li>
      <li>Next: <a href="tutorial_5.html" title="next chapter">Tutorial 5: Models and Simulations</a></li>
  </ul></li>
</ul>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, SunPower.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/tutorials/tutorial_4.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/BreakingBytes/SimKit" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>